/*!
 * vdom-engine.js v0.1.0
 * (c) 2016 Jade Gu
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.Vengine=n()}(this,function(){"use strict";function e(e){_.push(e)}function n(e){_=_.filter(function(n){return n!==e})}function r(e){for(var n=0,r=_.length;r>n;n++){var t=_[n],o=t.test,a=typeof o,i=!1;if("string"===a?e===o&&(i=!0):"function"===a?o(e)&&(i=!0):i=o.test(e),i)return t}}function t(e,n,r){var t=d(n);e[t]=r}function o(e,n){var r=d(n);e[r]=""}function a(e,n,r,a){r!==a&&(null==r?o(e,n):t(e,n,r))}function i(e,n,r){var t=p(n);e.setAttribute(t,r)}function c(e,n){var r=p(n);e.removeAttribute(r,propValue)}function u(e,n,r,t){r!==t&&(null==r?c(e,n):i(e,n,r))}function l(e,n,r,t){var o=s(n),a=t.namespace;e.setAttributeNS(a,o,r)}function f(e,n){var r=s(n);e.removeAttribute(r,propValue)}function v(e,n,r,t,o){r!==t&&(null==r?f(e,n):l(e,n,r,o))}function d(e){return e.match(ee)[1]}function p(e){var n=e.match(ne);return"attr"===n[1]?n[2]:n[0]}function s(e){return e.match(re)[1]}function h(e,n){for(var r in n)n.hasOwnProperty(r)&&b(e,r,n[r])}function y(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]="")}function m(e,n,r){if(n!==r){if(!r&&n)return void y(e,n);if(r&&!n)return void h(e,r);var t={};for(var o in n)n.hasOwnProperty(o)&&(t[o]=!0,n[o]!==r[o]&&b(e,o,r[o]));for(var o in r)r.hasOwnProperty(o)&&t[o]!==!0&&n[o]!==r[o]&&b(e,o,r[o])}}function g(e,n){return e+n.charAt(0).toUpperCase()+n.substring(1)}function b(e,n,r){return!ce[n]&&le.test(r)?void(e[n]=r+"px"):("float"===n&&(n="cssFloat"),null!=r&&"boolean"!=typeof r||(r=""),void(e[n]=r))}function w(e){return e.replace("on-","on").toLowerCase()}function x(e,n,r){if(n=w(n),1===fe[n])return void(e[n]=r);var t=e.eventStore||(e.eventStore={});t[n]=r,ye[n]||(document.addEventListener(n.substr(2),k,!1),ye[n]=!0),pe&&n===he&&e.addEventListener("click",se,!1);var o=e.nodeName;"onchange"!==n||"INPUT"!==o&&"TEXTAREA"!==o||x(e,"oninput",r)}function C(e,n){if(n=w(n),1===fe[n])return void(e[n]=null);var r=e.eventStore||(e.eventStore={});delete r[n],pe&&n===he&&e.removeEventListener("click",se,!1);var t=e.nodeName;"onchange"!==n||"INPUT"!==t&&"TEXTAREA"!==t||delete r.oninput}function O(e,n,r,t){r!==t&&(null==t?C(e,n):x(e,n,r))}function k(e){for(var n=e.target,r=e.type,t="on"+r,o=null;n;){var a=n,i=a.eventStore,c=i&&i[t];if(c){if(o||(o=E(e)),o.currentTarget=n,c.call(n,o),o.$cancalBubble)break;n=n.parentNode}else n=n.parentNode}}function E(e){var n={},r=function(){return n.$cancalBubble=!0};n.nativeEvent=e;for(var t in e)"function"!=typeof e[t]?n[t]=e[t]:"stopPropagation"===t||"stopImmediatePropagation"===t?n[t]=r:n[t]=e[t].bind(e);return n}function P(e){return e}function N(e,n){return function(){return e.apply(this,arguments),n.apply(this,arguments)}}function A(e,n,r){for(var t=e.length,o=-1;t--;){var a=e[++o];me(a)?A(a,n,r):n(a,r)}}function I(e,n){if(!n)return e;for(var r=Object.keys(n),t=r.length;t--;)e[r[t]]=n[r[t]];return e}function T(){return++ge}function S(e,n){for(var r in n)n.hasOwnProperty(r)&&z(e,r,n[r],n)}function j(e,n,t){var o={},a=null;for(var i in n)n.hasOwnProperty(i)&&(o[i]=!0,a=r(i),a&&a.patch(e,i,t[i],n[i],t,n));for(var i in t)t.hasOwnProperty(i)&&o[i]!==!0&&(a=r(i),a&&a.patch(e,i,t[i],n[i],t,n))}function z(e,n,t,o){if(null==t)return R(e,n,o);var a=r(n);a&&a.attach(e,n,t,o)}function R(e,n,t){var o=r(n);o&&o.detach(e,n,t)}function U(e){return{vtype:Oe,comment:e}}function L(e,n){var r=e.vtype,t=null;return r?r===xe?t=B(e,n):r===Ce?t=G(e,n):r===Oe&&(t=document.createComment(e.comment)):t=document.createTextNode(e),t}function V(e,n){var r=e.vtype;r===xe?W(e,n):r===Ce&&$(e,n)}function B(e,n){var r=e.type,t=e.props,o=null;"svg"===r||n===be?(o=document.createElementNS(be,r),n=be):o=document.createElement(r);var a=t.children,i=o.vchildren=[];me(a)?A(a,D,i):D(a,i);for(var c=0,u=i.length;u>c;c++)o.appendChild(L(i[c],n));return S(o,t),o}function D(e,n){null!=e&&"boolean"!=typeof e&&(n[n.length]=e.vtype?e:""+e)}function F(e,n,r){var t=e.props,o=(e.type,n.props),a=t["prop-innerHTML"],i=o.children,c=r.vchildren,u=r.childNodes,l=r.namespaceURI,f=c.length,v=r.vchildren=[];me(i)?A(i,D,v):D(i,v);var d=v.length;if(null==a&&f){for(var p=null,s=Array(d),h=0;f>h;h++)for(var y=c[h],m=0;d>m;m++)if(!s[m]){var g=v[m];if(y===g){s[m]={vnode:y,node:u[h]},c[h]=null;break}}e:for(var h=0;f>h;h++){var y=c[h];if(null!==y){for(var b=y.type,w=y.key,x=u[h],m=0;d>m;m++)if(!s[m]){var g=v[m];if(g.type===b&&g.key===w){s[m]={vnode:y,node:x};continue e}}p||(p=[]),p[p.length]=x,V(y,x)}}if(p)for(var h=0,C=p.length;C>h;h++)r.removeChild(p[h]);for(var h=0;d>h;h++){var g=v[h],O=s[h];if(O){var y=O.vnode,k=O.node;if(g!==y){var E=g.vtype;E?E===xe?k=F(y,g,k):E===Ce&&(k=M(y,g,k)):(k.newText=g,ke[ke.length]=k)}var P=u[h];P!==k&&r.insertBefore(k,P||null)}else{var k=L(g,l);r.insertBefore(k,u[h]||null)}}r.props=t,r.newProps=o,Pe[Pe.length]=r}else{j(r,t,o);for(var h=0;d>h;h++)r.appendChild(L(v[h],l))}return r}function W(e,n){for(var r=e.props,t=n.vchildren,o=n.childNodes,a=0,i=t.length;i>a;a++)V(t[a],o[a]);n.eventStore=n.vchildren=null;for(var c in r)ve.test(c)&&(c=w(c),fe[c]===!0&&(n[c]=null))}function G(e,n){var r=H(e),t=L(r,n);return t.cache=t.cache||{},t.cache[e.id]=r,t}function M(e,n,r){var t=e.id,o=r.cache[t];delete r.cache[t];var a=H(n),i=Y(o,a,r);return i.cache=i.cache||{},i.cache[n.id]=a,i!==r&&I(i.cache,r.cache),i}function $(e,n){var r=e.id,t=n.cache[r];delete n.cache[r],V(t,n)}function H(e){var n=e.type,r=e.props,t=n(r);if(t&&t.render&&(t=t.render()),null===t||t===!1)t=U("component placeholder: "+T());else if(!t||!t.vtype)throw new Error("@"+n.name+"#render:You may have returned undefined, an array or some other invalid object");return t}function X(){Ne(),Ee()}function Y(e,n,r){var t=r;if(null==n)V(e,r),r.parentNode.removeChild(r);else if(e.type!==n.type||n.key!==e.key)V(e,r),t=L(n,r.namespaceURI),r.parentNode.replaceChild(t,r);else if(e!==n){var o=e.vtype;o===xe?t=F(e,n,r):o===Ce&&(t=M(e,n,r))}return t}function q(e,n,r){if(!e.vtype)throw new Error("cannot render "+e+" to container");var t=n[we]||(n[we]=T()),o=Ae[t];if(o)return void(o===!0?Ae[t]=o=[e,r]:(o[0]=e,r&&(o[1]=o[1]?N(o[1],r):r)));Ae[t]=!0;var a=null,i=null;if(a=Ie[t])i=Y(a,e,n.firstChild);else{i=L(e,n.namespaceURI);for(var c=null;c=n.lastChild;)n.removeChild(c);n.appendChild(i)}Ie[t]=e,X(),o=Ae[t],delete Ae[t],me(o)&&renderTreeIntoContainer(o[0],n,o[1]),r&&r()}function J(e){if(!e.nodeName)throw new Error("expect node");var n=e[we],r=null;return(r=Ie[n])?(V(r,e.firstChild),e.removeChild(e.firstChild),delete Ie[n],!0):!1}function K(e,n,r){var t={};if(null!=n)for(var o in n)t[o]=n[o];var a=e.defaultProps;if(a)for(var o in a)void 0===t[o]&&(t[o]=a[o]);var i=arguments.length,c=r;if(i>3){c=Array(i-2);for(var u=2;i>u;u++)c[u-2]=arguments[u]}void 0!==c&&(t.children=c);var l=null,f=typeof e;if("string"===f)l={vtype:xe,type:e,props:t};else{if("function"!==f)throw new Error("unexpect type [ "+e+" ]");l={id:T(),vtype:Ce,type:e,props:t}}return l}function Q(e){return null!=e&&!!e.vtype}function Z(e){var n=function(){for(var n=arguments.length,r=Array(n),t=0;n>t;t++)r[t]=arguments[t];return K.apply(void 0,[e].concat(r))};return n.type=e,n}var _=[],ee=/^prop-(.+)/,ne=/^(attr|data|aria)-(.+)/,re=/^attrns-(.+)/,te={test:ee,attach:t,detach:o,patch:a},oe={test:ne,attach:i,detach:c,patch:u},ae={test:re,attach:l,detach:f,patch:v},ie={test:"style",attach:h,detach:y,patch:m},ce={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridColumn:1,fontWeight:1,lineClamp:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},ue=["Webkit","ms","Moz","O"];Object.keys(ce).forEach(function(e){ue.forEach(function(n){ce[g(n,e)]=1})});var le=/^-?\d+(\.\d+)?$/,fe={onmouseleave:1,onmouseenter:1,onload:1,onunload:1,onscroll:1,onfocus:1,onblur:1,onrowexit:1,onbeforeunload:1,onstop:1,ondragdrop:1,ondragenter:1,ondragexit:1,ondraggesture:1,ondragover:1,oncontextmenu:1},ve=/^on-.+/i,de={test:ve,attach:x,detach:C,patch:O},pe="ontouchstart"in document,se=function(){},he="onclick",ye={},me=Array.isArray,ge=0;Object.freeze||(Object.freeze=P);var be="http://www.w3.org/2000/svg",we="liteid",xe=1,Ce=2,Oe=3,ke=[],Ee=function(){var e=ke.length;if(e){var n=ke;ke=[];for(var r=0;e>r;r++){var t=n[r];t.nodeValue=t.newText}}},Pe=[],Ne=function(){var e=Pe.length;if(e){var n=Pe;Pe=[];for(var r=0;e>r;r++){var t=n[r];j(t,t.props,t.newProps),t.props=t.newProps=null}}},Ae={},Ie={};e(oe),e(ae),e(te),e(ie),e(de);var Te={createElement:K,createFactory:Z,isValidElement:Q,addDirective:e,removeDirective:n,render:q,destroy:J};return Te});