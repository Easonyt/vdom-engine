/*!
 * vdom-engine.js v0.1.2
 * (c) 2016 Jade Gu
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.Vengine=n()}(this,function(){"use strict";function e(e){return e}function n(e,n){return function(){return e.apply(this,arguments),n.apply(this,arguments)}}function r(e,n){for(var r=e.length,t=-1;r--;){var o=e[++t];J(o)?flattenChildren(o,n):null!=o&&"boolean"!=typeof o&&(n[n.length]=o)}}function t(e,n){if(!n)return e;for(var r=Object.keys(n),t=r.length;t--;)e[r[t]]=n[r[t]];return e}function o(){return++K}function a(e,n){for(var r in n){var t=u(r);if(t){var o=n[r];null!=o&&t.attach(e,t.key,o,n)}}}function i(e,n,r){var t={},o=null;for(var a in n)t[a]=!0,o=u(a),o&&o.patch(e,o.key,r[a],n[a],r,n);for(var a in r)t[a]!==!0&&(o=u(a),o&&o.patch(e,o.key,r[a],n[a],r,n))}function l(e,n){Q[e]=n}function c(e){delete Q[e]}function u(e){if("style"===e)return Q.style;var n=e.match(Z);if(n){var r=Q[n[1]];if(r)return r.key=n[2],r}}function f(e,n,r){e[n]=r}function v(e,n){e[n]=""}function d(e,n,r,t){r!==t&&(null==r?e[n]="":e[n]=r)}function p(e,n,r){e.setAttribute(n,r)}function h(e,n){e.removeAttribute(n)}function s(e,n,r,t){r!==t&&(null==r?e.removeAttribute(n):e.setAttribute(n,r))}function y(e){return e.replace("on-","on").toLowerCase()}function m(e,n,r){if(n=y(n),1===ne[n])return void(e[n]=r);var t=e.eventStore||(e.eventStore={});t[n]=r,le[n]||(document.addEventListener(n.substr(2),k,!1),le[n]=!0),oe&&n===ie&&e.addEventListener("click",ae,!1);var o=e.nodeName;"onchange"!==n||"INPUT"!==o&&"TEXTAREA"!==o||m(e,"oninput",r)}function g(e,n){if(n=y(n),1===ne[n])return void(e[n]=null);var r=e.eventStore||(e.eventStore={});delete r[n],oe&&n===ie&&e.removeEventListener("click",ae,!1);var t=e.nodeName;"onchange"!==n||"INPUT"!==t&&"TEXTAREA"!==t||delete r.oninput}function b(e,n,r,t){r!==t&&(null==t?g(e,n):m(e,n,r))}function k(e){for(var n=e.target,r=e.type,t="on"+r,o=null;n;){var a=n,i=a.eventStore,l=i&&i[t];if(l){if(o||(o=w(e)),o.currentTarget=n,l.call(n,o),o.$cancalBubble)break;n=n.parentNode}else n=n.parentNode}}function w(e){var n={},r=function(){return n.$cancalBubble=!0};n.nativeEvent=e;for(var t in e)"function"!=typeof e[t]?n[t]=e[t]:"stopPropagation"===t||"stopImmediatePropagation"===t?n[t]=r:n[t]=e[t].bind(e);return n}function x(e,n){for(var r in n)A(e,r,n[r])}function C(e,n){for(var r in n)e[r]=""}function E(e,n,r){if(n!==r){if(!r&&n)return void C(e,n);if(r&&!n)return void x(e,r);var t={};for(var o in n)t[o]=!0,n[o]!==r[o]&&A(e,o,r[o]);for(var o in r)t[o]!==!0&&n[o]!==r[o]&&A(e,o,r[o])}}function N(e,n){return e+n.charAt(0).toUpperCase()+n.substring(1)}function A(e,n,r){return!ue[n]&&ve.test(r)?void(e[n]=r+"px"):("float"===n&&(n="cssFloat"),null!=r&&"boolean"!=typeof r||(r=""),void(e[n]=r))}function I(e){return{vtype:ye,comment:e}}function O(e,n){var r=e.vtype,t=null;return r?r===he?t=P(e,n):r===se?t=F(e,n):r===ye&&(t=document.createComment(e.comment)):t=document.createTextNode(""+e),t}function T(e,n){var r=e.vtype;r===he?D(e,n):r===se&&G(e,n)}function S(e,n,r){var t=r,o=n.vtype;return o?o===he?t=U(e,n,t):o===se&&(t=W(e,n,t)):(t.newText=n+"",me[me.length]=t),t}function P(e,n){var r=e.type,t=e.props,o=null;return"svg"===r||n===de?(n=de,o=document.createElementNS(de,r)):o=document.createElement(r),R(o,t.children),a(o,t),o}function R(e,n){for(var r=e.namespaceURI,t=0,o=n.length;o>t;t++){var a=n[t],i=O(n[t],r);i.vnode=a,e.appendChild(i)}}function U(e,n,r){var t=e.props,o=(e.type,n.props),a=t["prop-innerHTML"],l=t.children,c=o.children;if(null==a&&l.length){var u=z(r,l,c);j(r,c,u),r.props=t,r.newProps=o,be[be.length]=r}else i(r,t,o),R(r,c);return r}function j(e,n,r){for(var t=n.length,o=e.childNodes,a=e.namespaceURI,i=0;t>i;i++){var l=n[i],c=r[i],u=null;if(c){var f=c.vnode;u=c,c.vnode=null,l!==f&&(u=S(f,l,c));var v=o[i];v!==u&&e.insertBefore(u,v||null)}else u=O(l,a),e.insertBefore(u,o[i]||null);u.vnode=l}}function z(e,n,r){var t=e.childNodes,o=n.length,a=r.length,i=Array(o),l=Array(a);return L(n,r,t,l,i),B(n,r,t,l,i),l}function L(e,n,r,t,o){for(var a=e.length,i=n.length,l=0;a>l;l++)for(var c=e[l],u=0;i>u;u++)if(!t[u]){var f=n[u];if(c===f){t[u]=r[l],o[l]=!0;break}}}function B(e,n,r,t,o){for(var a=e.length,i=n.length,l=null,c=0;a>c;c++)if(!o[c]){for(var u=r[c],f=e[c],v=f.type,d=f.key,p=!1,h=0;i>h;h++)if(!t[h]){var s=n[h];if(s.type===v&&s.key===d){t[h]=u,p=!0;break}}p||(l||(l=[]),l[l.length]=u,T(f,u))}if(l)for(var c=0,y=l.length;y>c;c++){var u=l[c];u.parentNode.removeChild(u)}}function D(e,n){for(var r=e.props,t=r.children,o=n.childNodes,a=0,i=t.length;i>a;a++)T(t[a],o[a]);n.eventStore=null;for(var l in r)re.test(l)&&(l=y(l),ne[l]===!0&&(n[l]=null))}function F(e,n){var r=M(e),t=O(r,n);return t.cache=t.cache||{},t.cache[e.id]=r,t}function W(e,n,r){var o=e.id,a=r.cache[o];delete r.cache[o];var i=M(n),l=V(a,i,r);return l.cache=l.cache||{},l.cache[n.id]=i,l!==r&&t(l.cache,r.cache),l}function G(e,n){var r=e.id,t=n.cache[r];delete n.cache[r],T(t,n)}function M(e){var n=e.type,r=e.props,t=n(r);if(t&&t.render&&(t=t.render()),null===t||t===!1)t=I("component placeholder: "+o());else if(!t||!t.vtype)throw new Error("@"+n.name+"#render:You may have returned undefined, an array or some other invalid object");return t}function V(e,n,r){var t=r;if(null==n)T(e,r),r.parentNode.removeChild(r);else if(e.type!==n.type||n.key!==e.key)T(e,r),t=O(n,r.namespaceURI),r.parentNode.replaceChild(t,r);else if(e!==n){var o=e.vtype;o===he?t=U(e,n,r):o===se&&(t=W(e,n,r))}return t}function $(e,r,t){if(!e.vtype)throw new Error("cannot render "+e+" to container");var a=r[pe]||(r[pe]=o()),i=we[a];if(i)return void(i===!0?we[a]={vnode:e,callback:t}:(i.vnode=e,t&&(i.callback=i.callback?n(i.callback,t):t)));we[a]=!0;var l=null,c=null;if(l=xe[a])c=V(l,e,r.firstChild);else{c=O(e,r.namespaceURI);for(var u=null;u=r.lastChild;)r.removeChild(u);r.appendChild(c)}xe[a]=e,ge(),ke(),i=we[a],delete we[a],J(i)&&renderTreeIntoContainer(i[0],r,i[1]),t&&t()}function H(e){if(!e.nodeName)throw new Error("expect node");var n=e[pe],r=null;return(r=xe[n])?(T(r,e.firstChild),e.removeChild(e.firstChild),delete xe[n],!0):!1}function X(e,n){var t={};if(null!=n)for(var a in n)t[a]=n[a];var i=e.defaultProps;if(i)for(var a in i)void 0===t[a]&&(t[a]=i[a]);for(var l=arguments.length,c=[],u=2;l>u;u++){var f=arguments[u];J(f)?r(f,c):null!=f&&"boolean"!=typeof f&&(c[c.length]=f)}t.children=c;var v=null,d=typeof e;if("string"===d)v={vtype:he,type:e,props:t};else{if("function"!==d)throw new Error("unexpect type [ "+e+" ]");v={id:o(),vtype:se,type:e,props:t}}return v}function Y(e){return null!=e&&!!e.vtype}function q(e){var n=function(){for(var n=arguments.length,r=Array(n),t=0;n>t;t++)r[t]=arguments[t];return X.apply(void 0,[e].concat(r))};return n.type=e,n}var J=Array.isArray,K=0;Object.freeze||(Object.freeze=e);var Q={},Z=/^(.+)-(.+)/,_={attach:f,detach:v,patch:d},ee={attach:p,detach:h,patch:s},ne={onmouseleave:1,onmouseenter:1,onload:1,onunload:1,onscroll:1,onfocus:1,onblur:1,onrowexit:1,onbeforeunload:1,onstop:1,ondragdrop:1,ondragenter:1,ondragexit:1,ondraggesture:1,ondragover:1,oncontextmenu:1},re=/^on-.+/i,te={attach:m,detach:g,patch:b},oe="ontouchstart"in document,ae=function(){},ie="onclick",le={},ce={attach:x,detach:C,patch:E},ue={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridColumn:1,fontWeight:1,lineClamp:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},fe=["Webkit","ms","Moz","O"];Object.keys(ue).forEach(function(e){fe.forEach(function(n){ue[N(n,e)]=1})});var ve=/^-?\d+(\.\d+)?$/,de="http://www.w3.org/2000/svg",pe="liteid",he=1,se=2,ye=3,me=[],ge=function(){var e=me.length;if(e){for(var n=me,r=-1;e--;){var t=n[++r];t.nodeValue=t.newText}me.length=0}},be=[],ke=function(){var e=be.length;if(e){for(var n=be,r=-1;e--;){var t=n[++r];i(t,t.props,t.newProps),t.props=t.newProps=null}be.length=0}},we={},xe={};l("attr",ee),l("data",ee),l("aria",ee),l("prop",_),l("on",te),l("style",ce);var Ce={createElement:X,createFactory:q,isValidElement:Y,addDirective:l,removeDirective:c,render:$,destroy:H};return Ce});