/*!
 * vdom-engine.js v0.1.0
 * (c) 2016 Jade Gu
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.Vengine=n()}(this,function(){"use strict";function e(e){Q.push(e)}function n(e){Q=Q.filter(function(n){return n!==e})}function t(e){for(var n=0,t=Q.length;t>n;n++){var r=Q[n],o=r.test,a=typeof o,i=!1;if("string"===a?e===o&&(i=!0):"function"===a?o(e)&&(i=!0):i=o.test(e),i)return r}}function r(e,n,t){var r=d(n);e[r]=t}function o(e,n){var t=d(n);e[t]=""}function a(e,n,t,a){t!==a&&(null==t?o(e,n):r(e,n,t))}function i(e,n,t){var r=p(n);e.setAttribute(r,t)}function c(e,n){var t=p(n);e.removeAttribute(t,propValue)}function u(e,n,t,r){t!==r&&(null==t?c(e,n):i(e,n,t))}function l(e,n,t,r){var o=h(n),a=r.namespace;e.setAttributeNS(a,o,t)}function f(e,n){var t=h(n);e.removeAttribute(t,propValue)}function v(e,n,t,r,o){t!==r&&(null==t?f(e,n):l(e,n,t,o))}function d(e){return e.match(Z)[1]}function p(e){var n=e.match(_);return"attr"===n[1]?n[2]:n[0]}function h(e){return e.match(ee)[1]}function s(e,n){for(var t in n)n.hasOwnProperty(t)&&b(e,t,n[t])}function y(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]="")}function m(e,n,t){if(n!==t){if(!t&&n)return void y(e,n);if(t&&!n)return void s(e,t);var r={};for(var o in n)n.hasOwnProperty(o)&&(r[o]=!0,n[o]!==t[o]&&b(e,o,t[o]));for(var o in t)t.hasOwnProperty(o)&&r[o]!==!0&&n[o]!==t[o]&&b(e,o,t[o])}}function g(e,n){return e+n.charAt(0).toUpperCase()+n.substring(1)}function b(e,n,t){return!ae[n]&&ce.test(t)?void(e[n]=t+"px"):("float"===n&&(n="cssFloat"),null!=t&&"boolean"!=typeof t||(t=""),void(e[n]=t))}function w(e){return e.replace("on-","on").toLowerCase()}function x(e,n,t){if(n=w(n),1===ue[n])return void(e[n]=t);var r=e.eventStore||(e.eventStore={});r[n]=t,he[n]||(document.addEventListener(n.substr(2),k,!1),he[n]=!0),ve&&n===pe&&e.addEventListener("click",de,!1);var o=e.nodeName;"onchange"!==n||"INPUT"!==o&&"TEXTAREA"!==o||x(e,"oninput",t)}function C(e,n){if(n=w(n),1===ue[n])return void(e[n]=null);var t=e.eventStore||(e.eventStore={});delete t[n],ve&&n===pe&&e.removeEventListener("click",de,!1);var r=e.nodeName;"onchange"!==n||"INPUT"!==r&&"TEXTAREA"!==r||delete t.oninput}function O(e,n,t,r){t!==r&&(null==r?C(e,n):x(e,n,t))}function k(e){for(var n=e.target,t=e.type,r="on"+t,o=null;n;){var a=n,i=a.eventStore,c=i&&i[r];if(c){if(o||(o=E(e)),o.currentTarget=n,c.call(n,o),o.$cancalBubble)break;n=n.parentNode}else n=n.parentNode}}function E(e){var n={},t=function(){return n.$cancalBubble=!0};n.nativeEvent=e;for(var r in e)"function"!=typeof e[r]?n[r]=e[r]:"stopPropagation"===r||"stopImmediatePropagation"===r?n[r]=t:n[r]=e[r].bind(e);return n}function P(e){return e}function N(e,n){return function(){return e.apply(this,arguments),n.apply(this,arguments)}}function A(e,n){for(var t=e.length,r=-1;t--;){var o=e[++r];se(o)?flattenChildren(o,n):null!=o&&"boolean"!=typeof o&&(n[n.length]=o.vtype?o:""+o)}}function I(e,n){if(!n)return e;for(var t=Object.keys(n),r=t.length;r--;)e[t[r]]=n[t[r]];return e}function T(){return++ye}function S(e,n){for(var t in n)n.hasOwnProperty(t)&&z(e,t,n[t],n)}function j(e,n,r){var o={},a=null;for(var i in n)n.hasOwnProperty(i)&&(o[i]=!0,a=t(i),a&&a.patch(e,i,r[i],n[i],r,n));for(var i in r)r.hasOwnProperty(i)&&o[i]!==!0&&(a=t(i),a&&a.patch(e,i,r[i],n[i],r,n))}function z(e,n,r,o){if(null==r)return R(e,n,o);var a=t(n);a&&a.attach(e,n,r,o)}function R(e,n,r){var o=t(n);o&&o.detach(e,n,r)}function U(e){return{vtype:xe,comment:e}}function L(e,n){var t=e.vtype,r=null;return t?t===be?r=B(e,n):t===we?r=W(e,n):t===xe&&(r=document.createComment(e.comment)):r=document.createTextNode(e),r}function V(e,n){var t=e.vtype;t===be?F(e,n):t===we&&M(e,n)}function B(e,n){var t=e.type,r=e.props,o=null;"svg"===t||n===me?(o=document.createElementNS(me,t),n=me):o=document.createElement(t);for(var a=r.children,i=0,c=a.length;c>i;i++)o.appendChild(L(a[i],n));return S(o,r),o}function D(e,n,t){var r=e.props,o=(e.type,n.props),a=r["prop-innerHTML"],i=t.childNodes,c=t.namespaceURI,u=r.children,l=o.children,f=u.length,v=l.length;if(null==a&&f){for(var d=null,p=Array(v),h=0;f>h;h++)for(var s=u[h],y=0;v>y;y++)if(!p[y]){var m=l[y];if(s===m){p[y]={vnode:s,node:i[h]},u[h]=null;break}}e:for(var h=0;f>h;h++){var s=u[h];if(null!==s){for(var g=s.type,b=s.key,w=i[h],y=0;v>y;y++)if(!p[y]){var m=l[y];if(m.type===g&&m.key===b){p[y]={vnode:s,node:w};continue e}}d||(d=[]),d[d.length]=w,V(s,w)}}if(d)for(var h=0,x=d.length;x>h;h++)t.removeChild(d[h]);for(var h=0;v>h;h++){var m=l[h],C=p[h];if(C){var s=C.vnode,O=C.node;if(m!==s){var k=m.vtype;k?k===be?O=D(s,m,O):k===we&&(O=G(s,m,O)):(O.newText=m,Ce[Ce.length]=O)}var E=i[h];E!==O&&t.insertBefore(O,E||null)}else{var O=L(m,c);t.insertBefore(O,i[h]||null)}}t.props=r,t.newProps=o,ke[ke.length]=t}else{j(t,r,o);for(var h=0;v>h;h++)t.appendChild(L(l[h],c))}return t}function F(e,n){for(var t=e.props,r=t.children,o=n.childNodes,a=0,i=r.length;i>a;a++)V(r[a],o[a]);n.eventStore=null;for(var c in t)le.test(c)&&(c=w(c),ue[c]===!0&&(n[c]=null))}function W(e,n){var t=$(e),r=L(t,n);return r.cache=r.cache||{},r.cache[e.id]=t,r}function G(e,n,t){var r=e.id,o=t.cache[r];delete t.cache[r];var a=$(n),i=H(o,a,t);return i.cache=i.cache||{},i.cache[n.id]=a,i!==t&&I(i.cache,t.cache),i}function M(e,n){var t=e.id,r=n.cache[t];delete n.cache[t],V(r,n)}function $(e){var n=e.type,t=e.props,r=n(t);if(r&&r.render&&(r=r.render()),null===r||r===!1)r=U("component placeholder: "+T());else if(!r||!r.vtype)throw new Error("@"+n.name+"#render:You may have returned undefined, an array or some other invalid object");return r}function H(e,n,t){var r=t;if(null==n)V(e,t),t.parentNode.removeChild(t);else if(e.type!==n.type||n.key!==e.key)V(e,t),r=L(n,t.namespaceURI),t.parentNode.replaceChild(r,t);else if(e!==n){var o=e.vtype;o===be?r=D(e,n,t):o===we&&(r=G(e,n,t))}return r}function X(e,n,t){if(!e.vtype)throw new Error("cannot render "+e+" to container");var r=n[ge]||(n[ge]=T()),o=Pe[r];if(o)return void(o===!0?Pe[r]=o=[e,t]:(o[0]=e,t&&(o[1]=o[1]?N(o[1],t):t)));Pe[r]=!0;var a=null,i=null;if(a=Ne[r])i=H(a,e,n.firstChild);else{i=L(e,n.namespaceURI);for(var c=null;c=n.lastChild;)n.removeChild(c);n.appendChild(i)}Ne[r]=e,Oe(),Ee(),o=Pe[r],delete Pe[r],se(o)&&renderTreeIntoContainer(o[0],n,o[1]),t&&t()}function Y(e){if(!e.nodeName)throw new Error("expect node");var n=e[ge],t=null;return(t=Ne[n])?(V(t,e.firstChild),e.removeChild(e.firstChild),delete Ne[n],!0):!1}function q(e,n){var t={};if(null!=n)for(var r in n)t[r]=n[r];var o=e.defaultProps;if(o)for(var r in o)void 0===t[r]&&(t[r]=o[r]);for(var a=arguments.length,i=[],c=2;a>c;c++){var u=arguments[c];se(u)?A(u,i):i[i.length]=u}t.children=i;var l=null,f=typeof e;if("string"===f)l={vtype:be,type:e,props:t};else{if("function"!==f)throw new Error("unexpect type [ "+e+" ]");l={id:T(),vtype:we,type:e,props:t}}return l}function J(e){return null!=e&&!!e.vtype}function K(e){var n=function(){for(var n=arguments.length,t=Array(n),r=0;n>r;r++)t[r]=arguments[r];return q.apply(void 0,[e].concat(t))};return n.type=e,n}var Q=[],Z=/^prop-(.+)/,_=/^(attr|data|aria)-(.+)/,ee=/^attrns-(.+)/,ne={test:Z,attach:r,detach:o,patch:a},te={test:_,attach:i,detach:c,patch:u},re={test:ee,attach:l,detach:f,patch:v},oe={test:"style",attach:s,detach:y,patch:m},ae={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridColumn:1,fontWeight:1,lineClamp:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},ie=["Webkit","ms","Moz","O"];Object.keys(ae).forEach(function(e){ie.forEach(function(n){ae[g(n,e)]=1})});var ce=/^-?\d+(\.\d+)?$/,ue={onmouseleave:1,onmouseenter:1,onload:1,onunload:1,onscroll:1,onfocus:1,onblur:1,onrowexit:1,onbeforeunload:1,onstop:1,ondragdrop:1,ondragenter:1,ondragexit:1,ondraggesture:1,ondragover:1,oncontextmenu:1},le=/^on-.+/i,fe={test:le,attach:x,detach:C,patch:O},ve="ontouchstart"in document,de=function(){},pe="onclick",he={},se=Array.isArray,ye=0;Object.freeze||(Object.freeze=P);var me="http://www.w3.org/2000/svg",ge="liteid",be=1,we=2,xe=3,Ce=[],Oe=function(){var e=Ce.length;if(e){for(var n=Ce,t=0;e>t;t++){var r=n[t];r.nodeValue=r.newText}Ce.length=0}},ke=[],Ee=function(){var e=ke.length;if(e){for(var n=ke,t=0;e>t;t++){var r=n[t];j(r,r.props,r.newProps),r.props=r.newProps=null}ke.length=0}},Pe={},Ne={};e(te),e(re),e(ne),e(oe),e(fe);var Ae={createElement:q,createFactory:K,isValidElement:J,addDirective:e,removeDirective:n,render:X,destroy:Y};return Ae});