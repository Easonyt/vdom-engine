/*!
 * vdom-engine.js v0.1.5
 * (c) 2016 Jade Gu
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.Vengine=n()}(this,function(){"use strict";function e(e,n){J[e]=n}function n(e){delete J[e]}function t(e){var n=e.match(K);return n?(Q=n[2],J[n[1]]):void 0}function r(e,n,r){var o=t(n);o&&o.attach(e,Q,r)}function o(e,n){var r=t(n);r&&r.detach(e,Q)}function a(e,n){for(var t in n)null!=n[t]&&r(e,t,n[t])}function i(e,n,t){for(var a in n)t.hasOwnProperty(a)?t[a]!==n[a]&&(null==t[a]?o(e,a):r(e,a,t[a])):o(e,a);for(var a in t)n.hasOwnProperty(a)||r(e,a,t[a])}function l(e,n,t){e[n]=t}function c(e,n){e[n]=""}function u(e,n,t){e.setAttribute(n,t+"")}function f(e,n){e.removeAttribute(n)}function d(e,n){e.eventStore=null;for(var t in n)0===t.indexOf("on-")&&(t=v(t),ee[t]&&(e[t]=null))}function v(e){return e.replace(/^on-/,"on").toLowerCase()}function p(e,n,t){if(n="on"+n,1===ee[n])return void(e[n]=t);var r=e.eventStore||(e.eventStore={});r[n]=t,ae[n]||(document.addEventListener(n.substr(2),s,!1),ae[n]=!0),te&&n===oe&&e.addEventListener("click",re,!1);var o=e.nodeName;"onchange"!==n||"INPUT"!==o&&"TEXTAREA"!==o||p(e,"oninput",t)}function h(e,n){if(n="on"+n,1===ee[n])return void(e[n]=null);var t=e.eventStore||(e.eventStore={});delete t[n],te&&n===oe&&e.removeEventListener("click",re,!1);var r=e.nodeName;"onchange"!==n||"INPUT"!==r&&"TEXTAREA"!==r||delete t.oninput}function s(e){for(var n=e.target,t=e.type,r="on"+t,o=null;n;){var a=n,i=a.eventStore,l=i&&i[r];if(l){if(o||(o=y(e)),o.currentTarget=n,l.call(n,o),o.$cancalBubble)break;n=n.parentNode}else n=n.parentNode}}function y(e){var n={},t=function(){return n.$cancalBubble=!0};n.nativeEvent=e;for(var r in e)"function"!=typeof e[r]?n[r]=e[r]:"stopPropagation"===r||"stopImmediatePropagation"===r?n[r]=t:n[r]=e[r].bind(e);return n}function m(e,n,t){w(e.style,n,t)}function g(e,n){e.style[n]=""}function b(e,n){return e+n.charAt(0).toUpperCase()+n.substring(1)}function w(e,n,t){return!le[n]&&ue.test(t)?void(e[n]=t+"px"):("float"===n&&(n="cssFloat"),null!=t&&"boolean"!=typeof t||(t=""),void(e[n]=t))}function k(e){return"function"==typeof e}function x(e){return e}function C(e,n){return function(){return e.apply(this,arguments),n.apply(this,arguments)}}function E(e,n){for(var t=e.length,r=-1;t--;){var o=e[++r];fe(o)?E(o,n):null!=o&&"boolean"!=typeof o&&(n[n.length]=o)}}function N(e,n){if(!n)return e;for(var t=Object.keys(n),r=t.length;r--;)e[t[r]]=n[t[r]];return e}function O(){return++de}function P(e){return{vtype:ye,comment:e}}function I(e,n){var t=e.vtype,r=null;return t?t===he?r=S(e,n):t===se?r=D(e,n):t===ye&&(r=document.createComment(e.comment)):r=document.createTextNode(""+e),r}function A(e,n){var t=e.vtype;t===he?B(e,n):t===se&&W(e,n)}function T(e,n,t){var r=t,o=n.vtype;return o?o===he?r=R(e,n,r):o===se&&(r=F(e,n,r)):(r.newText=n+"",Ee[Ee.length]=r),r}function S(e,n){var t=e.type,r=e.props,o=null;return"svg"===t||n===ve?(n=ve,o=document.createElementNS(ve,t)):o=document.createElement(t),U(o,r.children),a(o,r),r[me]&&r[me].apply(null,o),r[ge]&&(xe[xe.length]=o,o.onmount=r[ge]),o}function U(e,n){for(var t=e.namespaceURI,r=0,o=n.length;o>r;r++){var a=n[r],i=I(n[r],t);i.vnode=a,e.appendChild(i)}}function R(e,n,t){var r=e.props,o=(e.type,n.props),a=r["prop-innerHTML"],l=r.children,c=o.children;if(o[be]&&o[be].call(null,t),null==a&&l.length){var u=z(t,l,c);j(t,c,u),t.props=r,t.newProps=o,Oe[Oe.length]=t}else i(t,r,o),U(t,c),o[we]&&o[we].call(null,t);return t}function j(e,n,t){for(var r=n.length,o=e.childNodes,a=e.namespaceURI,i=0;r>i;i++){var l=n[i],c=t[i],u=null;if(c){var f=c.vnode;u=c,c.vnode=null,l!==f&&(u=T(f,l,c));var d=o[i];d!==u&&e.insertBefore(u,d||null)}else u=I(l,a),e.insertBefore(u,o[i]||null);u.vnode=l}}function z(e,n,t){var r=e.childNodes,o=n.length,a=t.length,i=Array(o),l=Array(a);return L(n,t,r,l,i),M(n,t,r,l,i),l}function L(e,n,t,r,o){for(var a=e.length,i=n.length,l=0;a>l;l++)for(var c=e[l],u=0;i>u;u++)if(!r[u]){var f=n[u];if(c===f){r[u]=t[l],o[l]=!0;break}}}function M(e,n,t,r,o){for(var a=e.length,i=n.length,l=null,c=0;a>c;c++)if(!o[c]){for(var u=t[c],f=e[c],d=f.type,v=f.key,p=!1,h=0;i>h;h++)if(!r[h]){var s=n[h];if(s.type===d&&s.key===v){r[h]=u,p=!0;break}}p||(l||(l=[]),l[l.length]=u,A(f,u))}if(l)for(var c=0,y=l.length;y>c;c++){var u=l[c];u.parentNode.removeChild(u)}}function B(e,n){for(var t=e.props,r=t.children,o=n.childNodes,a=0,i=r.length;i>a;a++)A(r[a],o[a]);k(t[ke])&&t[ke].call(null,n),d(n,t)}function D(e,n){var t=$(e),r=I(t,n);return r.cache=r.cache||{},r.cache[e.id]=t,r}function F(e,n,t){var r=e.id,o=t.cache[r];delete t.cache[r];var a=$(n),i=G(o,a,t);return i.cache=i.cache||{},i.cache[n.id]=a,i!==t&&N(i.cache,t.cache),i}function W(e,n){var t=e.id,r=n.cache[t];delete n.cache[t],A(r,n)}function $(e){var n=e.type,t=e.props,r=n(t);if(r&&r.render&&(r=r.render()),null===r||r===!1)r=P("component placeholder: "+O());else if(!r||!r.vtype)throw new Error("@"+n.name+"#render:You may have returned undefined, an array or some other invalid object");return r}function G(e,n,t){var r=t;if(null==n)A(e,t),t.parentNode.removeChild(t);else if(e.type!==n.type||n.key!==e.key)A(e,t),r=I(n,t.namespaceURI),t.parentNode.replaceChild(r,t);else if(e!==n){var o=e.vtype;o===he?r=R(e,n,t):o===se&&(r=F(e,n,t))}return r}function V(e,n,t){if(!e.vtype)throw new Error("cannot render "+e+" to container");var r=n[pe]||(n[pe]=O()),o=Ie[r];if(o)return void(o===!0?Ie[r]={vnode:e,callback:t}:(o.vnode=e,t&&(o.callback=o.callback?C(o.callback,t):t)));if(Ie[r]=!0,Ae.hasOwnProperty(r))G(Ae[r],e,n.firstChild);else{for(var a=I(e,n.namespaceURI),i=null;i=n.lastChild;)n.removeChild(i);n.appendChild(a)}Ae[r]=e,Ne(),Pe(),Ce(),o=Ie[r],Ie[r]=null,fe(o)&&renderTreeIntoContainer(o[0],n,o[1]),t&&t()}function H(e){if(!e.nodeName)throw new Error("expect node");var n=e[pe],t=null;return(t=Ae[n])?(A(t,e.firstChild),e.removeChild(e.firstChild),delete Ae[n],delete Ie[n],!0):!1}function X(e,n){var t={};if(null!=n)for(var r in n)t[r]=n[r];var o=e.defaultProps;if(o)for(var r in o)void 0===t[r]&&(t[r]=o[r]);for(var a=arguments.length,i=[],l=2;a>l;l++){var c=arguments[l];fe(c)?E(c,i):null!=c&&"boolean"!=typeof c&&(i[i.length]=c)}t.children=i;var u=null,f=typeof e;if("string"===f)u={vtype:he,type:e,props:t};else{if("function"!==f)throw new Error("unexpect type [ "+e+" ]");u={id:O(),vtype:se,type:e,props:t}}return u}function Y(e){return null!=e&&!!e.vtype}function q(e){var n=function(){for(var n=arguments.length,t=Array(n),r=0;n>r;r++)t[r]=arguments[r];return X.apply(void 0,[e].concat(t))};return n.type=e,n}var J={},K=/^([^-]+)-(.+)$/,Q=null,Z={attach:l,detach:c},_={attach:u,detach:f},ee={onmouseleave:1,onmouseenter:1,onload:1,onunload:1,onscroll:1,onfocus:1,onblur:1,onrowexit:1,onbeforeunload:1,onstop:1,ondragdrop:1,ondragenter:1,ondragexit:1,ondraggesture:1,ondragover:1,oncontextmenu:1},ne={attach:p,detach:h},te="ontouchstart"in document,re=function(){},oe="onclick",ae={},ie={attach:m,detach:g},le={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridColumn:1,fontWeight:1,lineClamp:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},ce=["Webkit","ms","Moz","O"];Object.keys(le).forEach(function(e){ce.forEach(function(n){le[b(n,e)]=1})});var ue=/^-?\d+(\.\d+)?$/,fe=Array.isArray,de=0;Object.freeze||(Object.freeze=x);var ve="http://www.w3.org/2000/svg",pe="liteid",he=1,se=2,ye=3,me="hook-willMount",ge="hook-didMount",be="hook-willUpdate",we="hook-didUpdate",ke="hook-willUnmount",xe=[],Ce=function(){var e=xe.length;if(e){for(var n=xe,t=-1;e--;){var r=n[++t];r.onmount.call(null,r),r.onmount=null}xe.length=0}},Ee=[],Ne=function(){var e=Ee.length;if(e){for(var n=Ee,t=-1;e--;){var r=n[++t];r.nodeValue=r.newText}Ee.length=0}},Oe=[],Pe=function(){var e=Oe.length;if(e){for(var n=Oe,t=-1;e--;){var r=n[++t];i(r,r.props,r.newProps),r.newProps[we]&&r.newProps[we].call(null,r),r.props=r.newProps=null}Oe.length=0}},Ie={},Ae={};e("attr",_),e("prop",Z),e("on",ne),e("css",ie);var Te={createElement:X,createFactory:q,isValidElement:Y,addDirective:e,removeDirective:n,render:V,destroy:H};return Te});